{"version":3,"file":"vue.js","sources":["../src/observe/array.js","../src/observe/index.js","../src/state.js","../src/compiler/index.js","../src/init.js","../src/index.js"],"sourcesContent":["/**\r\n * 使用object.create方法 将 数组的原型作为 重写方法的对象 的原型\r\n * Array原型上有 at、find、fill、forEach、map、pop、push、some、sort、splice这些方法\r\n * rebuildArrayPrototype是一个以Array的原型为原型的对象\r\n * 所以可以通过 rebuildArrayPrototype.__proto__ 访问到Array.prototype \r\n */\r\n\r\nlet arrayPrototye = Array.prototype\r\n\r\nlet rebuildArrayPrototype = Object.create(Array.prototype) \r\n//需要改写的方法合集\r\nlet methods = [\r\n  \"pop\",\r\n  \"push\",\r\n  \"shift\",\r\n  \"slice\",\r\n  \"sort\",\r\n  \"splice\",\r\n  \"unshift\"\r\n]\r\n\r\n//遍历需要改写的方法的合集\r\nmethods.forEach(method => {\r\n  //重写方法\r\n  rebuildArrayPrototype[method] = function(...args) {\r\n    let inserted;\r\n    let __observe__  = this.__observe__;\r\n    switch(method) {\r\n      case \"push\":\r\n      case \"unshift\":\r\n        inserted = args;\r\n        break;\r\n      case \"splice\":\r\n        inserted = args.slice(2);\r\n      default:\r\n        break\r\n    }\r\n    if(inserted) {\r\n      __observe__.observeArray(inserted)\r\n    }\r\n    //需要做的是，重新调用这些方法时，也变成响应式的\r\n    console.log(\"re build array\", this)\r\n    // this上保存着 构造方法的实例，所以可以访问\r\n    arrayPrototye[method].call(this, ...args);\r\n  }\r\n})\r\n\r\nexport default rebuildArrayPrototype","/**\r\n * 响应式核心\r\n * 但目前写法性能差：\r\n * - 对多层对象进行遍历；\r\n * - 数组则每一项都会添加get set方法\r\n * - 且数组长度更新是无法引起监听的\r\n * 就是一套玩具写法\r\n * =========》》优化 》》==========\r\n * 判断数组 重写数组的七个操作方法\r\n * pop push shift slice sort reserve unshift \r\n **/  \r\n\r\nimport rebuildArrayPrototype from \"./array\"\r\n\r\n//使用类是为了内聚相关操作\r\nclass Observe {\r\n  constructor(data) {\r\n\r\n    Object.defineProperty(data, \"__observe__\", {\r\n      value: this,\r\n      enumerable: false\r\n    })\r\n\r\n    if(Array.isArray(data)) {\r\n      data.__proto__ = rebuildArrayPrototype\r\n      // 将监听的数据也变成响应式的\r\n      this.observeArray(data);\r\n    } else {\r\n      //遍历data的数据\r\n      this.walk(data)\r\n    }\r\n  }\r\n  // 数组的监听响应式\r\n  observeArray(data) {\r\n    data.forEach(item => observe(item))\r\n  }\r\n  // 对象遍历监听\r\n  walk(data) {\r\n    //不使用for in是为了避免访问到原型上的数据\r\n    const keys = Object.keys(data)\r\n    keys.forEach(key => {\r\n      defineReactive(data, key, data[key])\r\n    })\r\n  }\r\n}\r\n\r\n/**\r\n * 使用defineproperty 绑定set get方法，实现监听\r\n */\r\nfunction defineReactive(data, key, value) {\r\n  //对于嵌套对象处理\r\n  observe(value)\r\n  Object.defineProperty(data, key, {\r\n    get() {\r\n      return value;\r\n    },\r\n    set(newValue) {\r\n      if(newValue !== value) {\r\n        //如果set的是一个对象，则对这个对象也进行监听\r\n        observe(newValue)\r\n        value = newValue\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nexport default function observe(data) {\r\n  // 只有对象才会绑定响应式\r\n  if( typeof data !== \"object\" || data === null) return \r\n  // 如果被代理也直接返回\r\n  if(data.__observe__) return\r\n  new Observe(data)\r\n}\r\n\r\n","import observe from \"./observe/index\";\r\n\r\nexport default function initState(vm) {\r\n  //读取配置信息\r\n  const options = vm.$options\r\n\r\n  //判断options中包含的数据, 包含data则调用处理data的函数\r\n  if(options.data) {\r\n    initData(vm);\r\n  }\r\n}\r\n\r\n//处理data类型\r\nfunction initData(vm) {\r\n  let data = vm.$options.data;\r\n  //如果 data是函数则拿函数的返回值，如果是object，直接使用\r\n  data = typeof data === \"function\" ? data.call(vm) : data;\r\n  // 用户可以直接通过vm.XXX 或者vm._data.XXX直接访问数据\r\n  for(let key in data) {\r\n    proxy(vm, \"_data\", key)\r\n  }\r\n  //调用产生响应式的函数\r\n  observe(data);\r\n  // 代理options中的data\r\n  function proxy(data, source, key){\r\n    Object.defineProperty(data, key, {\r\n      get(){\r\n        return data[source][key];\r\n      },\r\n      set(newValue) {\r\n        vm[source][key] = newValue;\r\n      }\r\n    })\r\n  }\r\n}","// TODO:正则表达式学习\r\n// 检测标签 \r\nconst ncname = `[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*`;\r\n// `((?:[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*\\\\:)?[a-zA-Z_][\\\\-\\\\.0-9_a-zA-Z]*)`\r\nconst qnameCapture = `((?:${ncname}\\\\:)?${ncname})`\r\n// 检测标签开头\r\nconst startTagOpen = new RegExp(`^<${qnameCapture}`)\r\n// 捕获结束标签的标签名\r\nconst endTag = new RegExp(`^<\\\\/${qnameCapture}[^>]*>`);\r\n// 匹配属性\r\nconst attribute = /^\\s*([^\\s\"'<>\\/=]+)(?:\\s*(=)\\s*(?:\"([^\"]*)\"+|'([^']*)'+|([^\\s\"'=<>`]+)))?/;\r\n// 匹配结束标签 />\r\nconst startTagClose = /^\\s%(\\/?)>/;\r\n// 陪陪双花括号中间的内容\r\nconst defaultTagRE = /\\{\\{((?:.|\\r?\\n)=?)\\}\\}/g\r\n\r\n// 负责将模板解析为AST语法树\r\nfunction parseHtml(html) {\r\n\r\n  function advance(n) {\r\n    // substring 去除字符串的前n个字符后返回\r\n    html = html.substring(n)\r\n  }\r\n\r\n  //此时要不断循环html 一直截取到html为空\r\n  while(html) {\r\n    // indexOf 返回所需匹配字符的第一个下标 没有则为-1\r\n    let ishtmlEnd = html.indexOf(\"<\")\r\n    // 默认开头为 <div> 所以 isHtmlEnd 应该为 0\r\n    if(ishtmlEnd == '0') {\r\n      parseStartTag(html)\r\n      break;\r\n    }\r\n  \r\n    // 解析开始标签\r\n    function parseStartTag(html) {\r\n      // match 按照正则匹配字符串 无匹配结果返回null 有值则返回个包含匹配内容和方法的数组\r\n      const startTagMatches = html.match(startTagOpen);\r\n      if(startTagMatches) {\r\n        const match = {\r\n          tagName: startTagMatches[1]\r\n        }\r\n      }\r\n      console.log(startTagMatches)\r\n    }\r\n  \r\n  }\r\n}\r\n\r\nexport default function compileFunction(template) {\r\n  console.log(template);\r\n  let ast = parseHtml(template);\r\n}","\r\nimport initState from \"./state\";\r\nimport compileFunction from \"./compiler/index\"\r\n\r\nexport default function initMixin(Vueact) {\r\n  Vueact.prototype._init = function(options) {\r\n    const vm = this;\r\n    /**\r\n     * vue2有一个特性是特性是可以 通过实例的$options访问到配置信息，\r\n     * 所以把配置项添加到对象上\r\n    */ \r\n    \r\n    vm.$options = options;\r\n\r\n    /**\r\n     * init要做的事情之一：初始化数据\r\n     * 将数据变成响应式的\r\n     * vue的数据源有 props data computer watch \r\n     * 所以通过判断后 依次处理\r\n     * 当然具体逻辑放入到新的文件中处理\r\n     */  \r\n\r\n    //调用处理数据的函数\r\n    initState(vm);\r\n\r\n    //将vue options中的模板渲染\r\n    if(vm.$options.el) {\r\n      vm.$mount(vm.$options.el)\r\n    }\r\n  }\r\n  // 挂载函数\r\n  Vueact.prototype.$mount = function(el) {\r\n    const options = this.$options\r\n    const elDom = document.querySelector(el)\r\n    /**\r\n     * 如果有rander 则使用rander的内容\r\n     * 如果有template 则直接使用template\r\n     * 两个都无 则使用 el\r\n     */\r\n    if(!options.rander) {\r\n      let template = options.template\r\n      if(!template) {\r\n        template = elDom.outerHTML\r\n      }\r\n      const render = compileFunction(template)\r\n      options.render = render\r\n    }\r\n  }\r\n}","/**\r\n * 在vue2中 不通处理模块使用function的方式集合\r\n * 而在es6中所有的方法都推荐写在class内,\r\n * 不推荐混合使用prototype的形式.\r\n * 所以vue2依然使用构造函数的方式\r\n*/\r\n\r\nimport initMixin from \"./init\";\r\n\r\nfunction Vueact(options) {\r\n  this._init(options);\r\n}\r\n\r\n/**\r\n * 为了方便维护，每个属性都使用单独文件，\r\n * 这里通过initMixin讲init函数挂载至Vueact上\r\n*/ \r\ninitMixin(Vueact);\r\n\r\nexport default Vueact"],"names":["arrayPrototye","Array","prototype","rebuildArrayPrototype","Object","create","methods","forEach","method","_arrayPrototye$method","inserted","__observe__","_len","arguments","length","args","_key","slice","observeArray","console","log","call","apply","concat","Observe","data","_classCallCheck","defineProperty","value","enumerable","isArray","__proto__","walk","_createClass","key","item","observe","keys","defineReactive","get","set","newValue","_typeof","initState","vm","options","$options","initData","proxy","source","ncname","qnameCapture","startTagOpen","RegExp","parseHtml","html","_loop","ishtmlEnd","indexOf","parseStartTag","startTagMatches","match","tagName","compileFunction","template","initMixin","Vueact","_init","el","$mount","elDom","document","querySelector","rander","outerHTML","render"],"mappings":"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"}